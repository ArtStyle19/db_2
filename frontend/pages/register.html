<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="../css/style.css" rel="stylesheet">

  </head>
  <body class="d-flex flex-column min-vh-100">

    <header>
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="../index.html">
          <img src="../assets/logos/logo_UNA.png" alt="University Logo" height="90">
            Universidad Nacional del Altiplano
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Cursos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Logout</a>
            </li>

            <li class="nav-item">
              <a class=" btn btn-primary" href="./pages/login.html">Login/Register</a>
            </li>
          </ul>
        </div>

        <div class="nav-item" id="session-container">
          <div class="row">
            <div class="col-md-12">

              <!-- Session content will be loaded here dynamically -->
            </div>
          </div>
        </div>

      </nav>

    </header>




    <section class="ftco-section ftco-no-pb ftco-no-pt">
      <!-- <div class="nav-item dropdown"> -->
      <!-- Contenido del formulario de inicio de sesión -->
      <div class="container mt-4" id="login-register-container">
        <div class="login-register-form row">
          <div class="col-md-12 mt-4">
            <h2>Register</h2>
            <form id="register-form">
              <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" class="form-control" id="username" name="username" required>
              </div>
              <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" class="form-control" id="password" name="password" required>
              </div>
              <input type="hidden" name="register" value="1">
              <button type="submit" class="btn btn-primary py-2 px-4"  name="register">Register</button>
            </form>

            <p>Already have an account? <a href="login.html">Login</a></p>
          </div>

        </div>
      </div>

    </section>

    <footer class="footer mt-auto py-3 bg-light">
      <div class="container text-center">
        <span class="text-muted">© Universidad Nacional del Altiplano</span>
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- ajax -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>
    $(document).ready(function () {
      // Check session status on page load
      checkSessionStatus();

      // Function to check session status
      function checkSessionStatus() {
        $.ajax({
          url: '../../backend/check_session.php', // PHP file that checks session status
          type: 'GET',
          dataType: 'json', // Expect JSON response
          success: function (response) {
            // Update content based on session status
            if (response.loggedIn) {
              $('#session-container').html('<a href="#" id="logout"> '+  response.userDetails.username.toUpperCase() + '</a>');
              $('#login-register-container').hide();
              $('#loginDropdown').hide();
            } else {
              $('#session-container').html('');
              $('#login-register-container').show();
              $('#loginDropdown').show();
            }
          }
        });
      }

      // Form submission handlers
      $('#register-form').submit(function (event) {
        event.preventDefault();
        $.ajax({
          url: '../../backend/register.php',
          type: 'POST',
          data: $(this).serialize(),
          success: function (data) {
            console.log(data); // Log the response for debugging
            // After registration, re-check the session status
            document.location.href='../index.html';
            checkSessionStatus();


          }
        });
      });

      $('#login-form').submit(function (event) {
        event.preventDefault();
        $.ajax({
          url: '../../backend/login.php',
          type: 'POST',
          data: $(this).serialize(),
          success: function (data) {
            console.log(data); // Log the response for debugging
            // After login, re-check the session status
            document.location.href='../index.html';
            checkSessionStatus();
          }
        });
      });

      // Logout click handler
      $(document).on('click', '#logout', function (event) {
        event.preventDefault();
        $.ajax({
          url: '../../backend/logout.php',
          type: 'GET',
          success: function (data) {
            console.log(data); // Log the response for debugging
            // After logout, re-check the session status
            document.location.href='../index.html';
            checkSessionStatus();
          }
        });
      });


      $(document).ready(function() {
        // Abre el desplegable solo con clic en el botón
        $('#loginDropdown').click(function() {
          $('.dropdown-menu').toggle();
        });

        // Cierra el desplegable al hacer clic fuera de él o después de iniciar sesión
        $(document).click(function(e) {
          if (!$(e.target).closest('.dropdown').length && !$(e.target).closest('.dropdown-menu').length) {
            $('.dropdown-menu').hide();
          }
        });

        // Ejemplo de cierre del desplegable después de iniciar sesión (simulado)
        $('#login-form').submit(function(e) {
          // Aquí debes realizar tu lógica real de inicio de sesión
          // Actualmente, el código simula el cierre del desplegable después de enviar el formulario
          e.preventDefault();
          $('.dropdown-menu').hide();
        });

        $('#register-form').submit(function(e) {
          // Aquí debes realizar tu lógica real de inicio de sesión
          // Actualmente, el código simula el cierre del desplegable después de enviar el formulario
          e.preventDefault();
          $('.dropdown-menu').hide();
        });
        // Scroll to the bottom of the page on page load
        $(document).ready(function() {
          $('html, body').animate({ scrollTop: $(document).height()/2.5 }, 'slow');
        });






      });
    });
    </script>
  </body>
</html>

